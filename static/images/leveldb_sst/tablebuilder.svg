<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="208px" preserveAspectRatio="none" style="width:750px;height:208px;" version="1.1" viewBox="0 0 750 208" width="750px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cjpv2ykl1ro5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[17ddf46247c291617920d297554f609b]
class TableBuilder--><rect fill="#FEFECE" filter="url(#f1cjpv2ykl1ro5)" height="190.5059" id="TableBuilder" style="stroke: #A80036; stroke-width: 1.5;" width="732" x="7" y="7"/><ellipse cx="332.25" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M334.7231,29.1431 Q334.1421,29.4419 333.5029,29.5913 Q332.8638,29.7407 332.1582,29.7407 Q329.6514,29.7407 328.3315,28.0889 Q327.0117,26.437 327.0117,23.3159 Q327.0117,20.1865 328.3315,18.5347 Q329.6514,16.8828 332.1582,16.8828 Q332.8638,16.8828 333.5112,17.0322 Q334.1587,17.1816 334.7231,17.4805 L334.7231,20.2031 Q334.0923,19.6221 333.4988,19.3523 Q332.9053,19.0825 332.2744,19.0825 Q330.9297,19.0825 330.2449,20.1492 Q329.5601,21.2158 329.5601,23.3159 Q329.5601,25.4077 330.2449,26.4744 Q330.9297,27.541 332.2744,27.541 Q332.9053,27.541 333.4988,27.2712 Q334.0923,27.0015 334.7231,26.4204 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="73" x="352.75" y="27.5352">TableBuilder</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="8" x2="738" y1="39" y2="39"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="15" y="47"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="325" x="27" y="53.6348">Rep* rep_; // 一个专门的struct结构存储TableBuilder配置和状态</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="8" x2="738" y1="59.9551" y2="59.9551"/><ellipse cx="18" cy="70.9551" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="391" x="27" y="74.5898">void Add(const Slice&amp; key, const Slice&amp; value); // 往sst文件中写入一条数据</text><ellipse cx="18" cy="83.9102" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="238" x="27" y="87.5449">void Flush(); // 将当前data block写入到磁盘中</text><ellipse cx="18" cy="96.8652" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="224" x="27" y="100.5">Status status() const; // 当前builder的状态</text><ellipse cx="18" cy="109.8203" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="196" x="27" y="113.4551">Status Finish(); // 结束当前文件的写入</text><ellipse cx="18" cy="122.7754" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="296" x="27" y="126.4102">void Abandon(); // 表明当前builder里面的内容应该被丢弃</text><ellipse cx="18" cy="135.7305" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="331" x="27" y="139.3652">uint64_t NumEntries() const; // builder里面一共插入的记录数量</text><ellipse cx="18" cy="148.6855" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="286" x="27" y="152.3203">uint64_t FileSize() const; // 当前所产生的sst文件的大小</text><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="15" y="158.6406"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="195" x="27" y="165.2754">bool ok() const; // 返回builder的状态</text><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="15" y="171.5957"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="535" x="27" y="178.2305">void WriteBlock(BlockBuilder* block, BlockHandle* handle); // 把block中的内容写入到handle指向的位置</text><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="15" y="184.5508"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="706" x="27" y="191.1855">void WriteRawBlock(const Slice&amp; data, CompressionType, BlockHandle* handle); // 把data和compressionType写入到handle指向的位置</text><!--MD5=[b1624593e549349981a6823b3e3fbc87]
@startuml
skinparam dpi 2000
class TableBuilder {
  -Rep* rep_; // 一个专门的struct结构存储TableBuilder配置和状态

  +void Add(const Slice& key, const Slice& value); // 往sst文件中写入一条数据
  +void Flush(); // 将当前data block写入到磁盘中
  +Status status() const; // 当前builder的状态
  +Status Finish(); // 结束当前文件的写入
  +void Abandon(); // 表明当前builder里面的内容应该被丢弃
  +uint64_t NumEntries() const; // builder里面一共插入的记录数量
  +uint64_t FileSize() const; // 当前所产生的sst文件的大小
  -bool ok() const; // 返回builder的状态
  -void WriteBlock(BlockBuilder* block, BlockHandle* handle); // 把block中的内容写入到handle指向的位置
  -void WriteRawBlock(const Slice& data, CompressionType, BlockHandle* handle); // 把data和compressionType写入到handle指向的位置
}
@enduml

PlantUML version 1.2020.03beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.4+10-b304.77
Operating System: Mac OS X
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>
